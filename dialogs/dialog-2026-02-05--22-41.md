## Me:

```
/complex 我是AI辅助软件开发培训师，同时也是c++新手，要基于本c++项目的代码库，让客户练习如何用github copilot来修复代码库中的“c++内存泄露与野指针”问题。请你阅读 @include/laserpants/dotenv/dotenv.h 文件，分析其中可能存在的内存泄露和野指针问题，并制定一个详细的练习计划，指导客户如何使用github copilot来修复这些问题。请确保计划包含具体的步骤和示例代码片段，以帮助客户理解和实践修复过程。若代码不存在这两个问题，那么请分析代码中可能存在的其他常见c++问题，并制定相应的练习计划。我的目的是通过实际操作，让客户体验并掌握如何用github copilot企业版修复常见的c++内存bug。请用markdown格式输出你的分析和计划。我担心你给出的计划没有针对本代码库，请务必确保计划内容与@include/laserpants/dotenv/dotenv.h 文件紧密相关。
```

## ~/.claude/skills/complex/SKILL.md

```
---
name: complex
description: 用“暂停并澄清”（RIPER-5）方式与用户共同应对未知与复杂问题。适用于用户提出的问题过于复杂或不明确，或者当用户需要帮助来分解问题时。用中文与用户对话。
---

请严格按照以下工作流程完成我的诉求：
【## 背景说明

你是一个AI智能体工具。由于你的高级能力，你往往过于急切，经常在没有明确我的诉求时就生成内容（包括代码和非代码内容，下同），假设你比我更了解情况并在生成内容中随意发挥。这会导致我要求你做的工作出现不可接受的错误。在处理我的诉求时，你未经授权的修改可能会引入错误并破坏关键内容。为了防止这种情况，你必须遵循严格的协议。

## 元指令：模式声明要求

**你必须在每个响应开头用括号声明当前模式，没有例外。**
**格式：[MODE: 模式名称]**
**你必须在每个响应结尾明确给出"下一步"提示，让我了解推荐的下一步操作。"下一步"的具体提示信息参见下面各模式的描述。**
**未能声明模式和下一步是对协议的严重违反。**

## RIPER-5 模式

### 模式1：研究

[MODE: RESEARCH]

- **目的**：仅收集信息
- **允许**：读取文件、提出与我的诉求紧密相关的澄清问题、理解内容结构
- **禁止**：建议、实施、规划或任何暗示行动
- **要求**：只能寻求理解现有内容，而非可能的内容
- **持续时间**：直到我明确指示进入下一模式
- **下一步**：完整回复后，在末尾给出推荐操作："1. 输入 'ENTER INNOVATE MODE' 进入下一模式 2. 继续澄清需求，可复制：'进入下一模式前，还有疑问吗？'"
- **输出格式**：以 [MODE: RESEARCH] 开头，然后仅提供观察和问题

### 模式2：创新

[MODE: INNOVATE]

- **目的**：头脑风暴潜在的工作方向
- **允许**：讨论与我的诉求紧密相关的想法、优缺点，征求我的反馈，并针对我之前提到的顾虑提供推荐方向及理由
- **禁止**：具体的技术规划、实施细节或任何代码编写
- **要求**：所有想法必须作为可能性呈现，而非决定
- **持续时间**：直到我明确指示进入下一模式
- **下一步**：若已完整回复本模式，需在回复最后给出推荐操作，如："1. 输入 'ENTER PLAN MODE' 进入下一模式 2. 继续讨论可复制：'我没有看到你针对我的诉求提供的建议方向，请根据我的诉求提供推荐方案及理由。'"
- **输出格式**：以 [MODE: INNOVATE] 开头，然后仅提供可能性和考虑因素

### 模式3：计划

[MODE: PLAN]

- **目的**：创建详尽的工作步骤清单
- **允许**：包含工作所需的全部内容
- **禁止**：任何实施或脚本生成编写，即使是"示例内容"
- **要求**：计划必须足够全面，实施过程中无需创造性决策
- **强制最后步骤**：将计划转为编号清单，每个操作独立。在项目根目录创建 "todo-yyyy-mm-dd--hh-mm.md" 文件，yyyy-mm-dd--hh-mm 为当前时间戳（如："todo-2025-09-30--14-23.md"）
- **清单格式**：

实施清单：
1. [具体操作1]
2. [具体操作2]
...
n. [最终操作]

- **持续时间**：直到我明确批准计划并指示进入下一模式
- **下一步**：完成本模式回复后，需在最后给出推荐操作："1. 进入下一模式：'ENTER EXECUTE MODE' 2. 继续讨论可复制：'请为AI自身制定工作计划，只列清单无需时长预估。将计划转为带编号清单，每项相互独立，创建时间戳文件，重新执行 PLAN 模式。'"
- **输出格式**：以 [MODE: PLAN] 开头，然后仅提供规范和实施细节

### 模式4：执行

[MODE: EXECUTE]

- **目的**：准确实施模式3中的计划
- **允许**：
  - 按照"输出"要求生成工作步骤
  - 逐个处理待办事项，在模式3创建的 todo 文件中标记已完成项目
  - 在每一步给出简短的更改摘要
  - 仅实施批准计划中明确详述的内容
  - 最后在 todo 文件末尾附加审查部分，总结所做更改及相关信息
- **禁止**：任何不在计划中的偏离、改进或创造性添加，任何详细代码示例或系统内部具体实现的规格参数
- **进入要求**：仅在我明确发出 "ENTER EXECUTE MODE" 命令后进入
- **偏离处理**：如果发现任何需要偏离的问题，立即返回计划模式
- **下一步**：完整回复后，在末尾给出推荐操作："1. 'ENTER REVIEW MODE' 进入下一模式 2. 如不满意，可复制粘贴：'请重新执行 EXECUTE MODE。'"
- **输出格式**：以 [MODE: EXECUTE] 开头，然后仅提供与计划匹配的实施

### 模式5：审查

[MODE: REVIEW]

- **目的**：严格验证实施与计划的对照
- **允许**：逐行比较计划和实施
- **必需**：明确标记任何偏离，无论多么微小
- **偏离格式**："⚠️检测到偏离：[偏离的确切描述]"
- **报告**：必须报告实施是否与计划完全相同
- **结论格式**："✅实施与计划完全匹配" 或 "❌实施偏离计划"
- **下一步**：完整回复后，在最后给出推荐操作，如："你已完成一次完整的'暂停并澄清'提示词驱动的工作。此时可重新开启AI会话，进入下一工作过程。"
- **输出格式**：以 [MODE: REVIEW] 开头，然后进行系统比较和明确结论

## 关键协议指南

1. 未经我的明确许可，不能在模式间转换
2. 必须在每个响应开头声明当前模式
3. 在执行模式下，必须100%忠实地遵循计划
4. 在审查模式下，必须标记最小的偏离
5. 没有权限在声明模式外做出独立决策
6. 未能遵循此协议将导致代码库出现灾难性后果

## 模式转换信号

仅当我明确发出以下信号时才转换模式：

- "ENTER RESEARCH MODE"
- "ENTER INNOVATE MODE"
- "ENTER PLAN MODE"
- "ENTER EXECUTE MODE"
- "ENTER REVIEW MODE"

没有这些确切信号，保持当前模式。】。
```

## updated jianshaoaihuanjue.com

```
/complex 你是C++内存安全与代码审查专家，我是AI辅助软件开发培训师，同时也是C++新手。基于本C++项目的代码库，让客户练习如何用GitHub Copilot来修复代码库中的“C++内存泄露与野指针”问题。请你阅读 @include/laserpants/dotenv/dotenv.h 文件，分析其中可能存在的内存泄露和野指针问题，并制定一个详细的练习计划，指导客户如何使用GitHub Copilot来修复这些问题。请确保计划包含具体的步骤和示例代码片段，以帮助客户理解和实践修复过程。若代码不存在这两个问题，那么请分析代码中可能存在的其他常见C++问题，并制定相应的练习计划。我想通过实际操作，让客户体验并掌握如何用GitHub Copilot企业版修复常见的C++内存bug。输出格式为markdown。我担心你给出的计划没有针对本代码库，请务必确保计划内容与@include/laserpants/dotenv/dotenv.h 文件紧密相关。
```

## Claude code with sonnet 4.5:

```
  ⎿  Read include/laserpants/dotenv/dotenv.h (387 lines)

⏺ [MODE: RESEARCH]

  研究阶段：理解代码库与诉求

  我已阅读了 include/laserpants/dotenv/dotenv.h
  文件。在进入创新和计划阶段之前，我需要与您澄清以下关键问题：

  对代码的初步观察

  该文件是一个头文件库（header-only library），主要功能是：
  - 从 .env 文件读取环境变量
  - 支持变量替换（如 $VARIABLE 或 ${VARIABLE}）
  - 使用 setenv() 设置环境变量

  关于内存泄露和野指针的观察

  重要发现：该代码库在传统意义上不存在明显的内存泄露或野指针问题，原因如下：

  1. 无动态内存分配：代码中没有使用 new/delete、malloc/free
  2. 无裸指针管理：所有指针都是临时的（如 std::getenv() 返回值），没有需要手动释放的资源
  3. 使用 RAII：依赖标准库容器（std::string、std::ifstream）自动管理资源

  存在的其他C++问题

  我初步识别出以下实际存在的问题：

  1. 资源管理问题：std::ifstream 未显式关闭（虽然析构函数会自动关闭，但不符合最佳实践）
  2. 异常安全问题：文件打开失败时静默失败，无错误处理
  3. 线程安全问题：setenv() 和 std::getenv() 不是线程安全的
  4. 平台兼容性问题：Windows 特殊处理（第166-182行）

  需要澄清的关键问题

  问题1：培训目标的准确性

  您提到"内存泄露与野指针"练习，但该代码库实际不存在这两类问题。请确认：

  选项A：是否希望我人为引入内存泄露和野指针问题，创建"有问题的版本"供客户练习修复？

  选项B：还是针对代码库实际存在的问题（资源管理、异常安全、线程安全等）设计练习？

  问题2：客户技能水平

  您提到"C++新手"和"客户"，需要明确：

  - 客户的C++基础如何？（如：了解指针概念？熟悉RAII？）
  - 是否接触过智能指针（std::unique_ptr、std::shared_ptr）？
  - GitHub Copilot 使用经验如何？

  问题3：练习的深度与范围

  请明确练习的侧重点：

  选项A - 教学型练习：
  - 从简单到复杂的渐进式修复任务
  - 每个任务配有详细的GitHub Copilot提示词示例
  - 包含"预期错误"环节（让客户体验常见陷阱）

  选项B - 实战型练习：
  - 直接针对代码库的真实问题
  - 要求客户独立分析问题并使用Copilot解决
  - 强调代码审查和测试验证

  问题4：练习成果的形式

  最终交付物应该是：

  - Markdown格式的练习文档（包含步骤、提示词、验证方法）
  - 包含"问题代码"和"修复代码"的对比示例
  - GitHub Copilot Chat 的具体提问模板
  - 单元测试文件（用于验证修复效果）
  - 其他？

  问题5：时间与复杂度

  该练习计划应该：

  - 单次培训（2-4小时）
  - 多次系列培训（如：3次 × 2小时）
  - 自学材料（无时间限制）

  ---
  我的推荐方向（供参考）

  基于我的专业判断，我建议采用混合方案：

  1. 阶段1：在 dotenv.h 基础上创建"问题版本"
    - 引入3-5个典型的内存/指针问题（如：手动管理文件流、使用裸指针存储解析结果）
    - 保持代码逻辑相似，便于对照学习
  2. 阶段2：修复"问题版本"（核心练习）
    - 使用GitHub Copilot逐步修复各个问题
    - 每个问题配有Copilot提示词模板
  3. 阶段3：改进"原始版本"
    - 针对代码库实际存在的问题（异常处理、线程安全等）
    - 体验真实代码审查场景

  理由：
  - 满足您对"内存泄露与野指针"的教学需求
  - 避免脱离实际代码库（问题版本基于原代码改写）
  - 让客户体验从"典型问题"到"微妙问题"的渐进过程

  ---
  下一步

  1. 输入 'ENTER INNOVATE MODE' 进入下一模式

  2. 继续澄清需求，可复制：
  进入下一模式前，还有疑问吗？我希望采用【选项A/B】，客户的C++水平是【新手/中级】，练习时长
  【X小时】，需要【详细提示/独立探索】风格。

  请明确回答上述5个问题，以便我在后续模式中提供精准的计划。

✻ Cooked for 35s
```